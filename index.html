// --- NEW IMAGE SHARE FEATURE ---
        window.shareAsImage = async (elementId, fallbackText) => {
            const originalEl = document.getElementById(elementId);
            if (!originalEl) return;
            
            showToast('Generating HD Image...', 'success');
            
            // Card ke andar ke buttons ko hide karein taaki image me na aayein
            const originalButtons = originalEl.querySelectorAll('.share-hide-btn');
            originalButtons.forEach(e => e.style.display = 'none');

            // Ek off-screen wrapper banayein jisse design aur width fixed rahe
            const exportContainer = document.createElement('div');
            exportContainer.style.position = 'absolute';
            exportContainer.style.left = '-9999px';
            exportContainer.style.top = '0';
            exportContainer.style.width = '400px'; // Fixed width for mobile card look
            exportContainer.style.padding = '25px'; // Card ke aas paas breathing space
            exportContainer.style.backgroundColor = '#f8fafc'; // Halka background taaki white card pop kare
            exportContainer.style.zIndex = '-1';

            // Original card ko clone karein
            const clone = originalEl.cloneNode(true);
            
            // html2canvas ke liye strict inline styles apply karein (Tailwind fallback)
            clone.style.margin = '0';
            clone.style.width = '100%';
            clone.style.boxShadow = '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.05)';
            clone.style.borderRadius = '16px';
            clone.style.backgroundColor = '#ffffff';
            clone.style.border = '1px solid #e2e8f0';

            exportContainer.appendChild(clone);
            document.body.appendChild(exportContainer);

            try {
                // Ensure karein ki fonts aur icons puri tarah load ho chuke hain
                if (document.fonts && document.fonts.ready) {
                    await document.fonts.ready;
                }

                // HD scale aur transparent background ke sath capture
                const canvas = await html2canvas(exportContainer, { 
                    scale: 3, // HD Resolution
                    backgroundColor: null, 
                    useCORS: true,
                    allowTaint: true
                });
                
                // Kachra saaf karein (DOM Cleanup)
                document.body.removeChild(exportContainer);
                originalButtons.forEach(e => e.style.display = ''); // Original UI me buttons wapas laayein
                
                canvas.toBlob(async (blob) => {
                    const file = new File([blob], 'Wisefox_Card.png', { type: 'image/png' });
                    
                    if (navigator.canShare && navigator.canShare({ files: [file] })) {
                        try {
                            await navigator.share({ 
                                files: [file], 
                                title: 'Wisefox Details',
                                text: 'Lead Details via Wisefox Pro:'
                            });
                        } catch (err) {
                            console.log('Share canceled', err);
                        }
                    } else {
                        // Desktop fallback (Download Image + Open WhatsApp Web)
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'Wisefox_Card.png';
                        a.click();
                        URL.revokeObjectURL(url);
                        window.open(`https://wa.me/?text=${encodeURIComponent(fallbackText)}`, '_blank');
                    }
                }, 'image/png', 1.0);
                
            } catch (err) {
                // Agar fail ho jaye toh cleanup karke normal text share karde
                document.body.removeChild(exportContainer);
                originalButtons.forEach(e => e.style.display = '');
                showToast('Failed to generate image, sharing text.', 'error');
                window.open(`https://wa.me/?text=${encodeURIComponent(fallbackText)}`, '_blank');
            }
        };
